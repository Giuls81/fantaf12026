# FantaF1 2026 Master Plan

Based on the analysis of the current codebase (`web/App.tsx`, `api/src/server.ts`, `ios/`), here is the detailed roadmap for the next development phases.

## 1. Technical Debt & Architecture (High Priority)

The current `App.tsx` is over 1200 lines and handles too many responsibilities (UI, State, API, Logic). This is the biggest bottleneck for future features.

### Frontend Refactoring
- [ ] **Component Splitting**: Break `App.tsx` into smaller, focused components:
  - `components/Market.tsx` (Driver selection logic)
  - `components/Garage.tsx` (Team management)
  - `components/Standings.tsx` (League tables)
  - `components/AdminPanel.tsx` (Scoring & Rules)
- [ ] **Routing**: Implement `react-router-dom` to replace the `activeTab` state. This enables deep linking.
- [ ] **State Management**:
  - Replace manual `fetch` & `useEffect` chains with **TanStack Query (React Query)**. This handles caching, loading states, and refetching automatically.
  - Create a `UserContext` for global user state (League ID, Admin status).
- [ ] **Strict Typing**: Ensure all API responses in `web/types.ts` match `api/src/server.ts` exactly.

### Backend Evolution
- [ ] **Validation Layer**: Add `zod` or `valibot` to `api/src/server.ts` to validate all incoming requests (especially score updates and league creation).
- [ ] **Controller Pattern**: Extract route logic from `server.ts` into `api/src/controllers/` to keep the server file clean.

## 2. Core Feature Expansion

### League System 2.0
Currently, leagues seem basic. We need to enhance the social aspect.
- [ ] **Leaderboards**: Implement a proper leaderboard view in `components/Standings.tsx` fetching from `GET /leagues/:id/standings`.
- [ ] **Rivalries**: Add a "Head-to-Head" view to compare your team directly with another member's team.
- [ ] **Chat/Feed**: Simple message board for league members.

### Live Race Center
- [ ] **Integration**: Connect to a live F1 data provider (e.g., OpenF1 or a scraped source) to get real-time lap times/positions.
- [ ] **Live Scoring**: Calculate fantasy points in real-time during the race and push updates to the frontend (polling or WebSockets).

### Market Dynamics
- [ ] **Dynamic Pricing**: Implement an algorithm to adjust driver prices based on performance (e.g., +$0.5M for a win, -$0.2M for DNF).
- [ ] **Transfer Window**: High priority strict locking of transfers between races (already partially implemented with `lockState`, but needs backend enforcement).

## 3. DevOps & Infrastructure

### Mobile (Android & iOS)
- [ ] **Android CI**: Your `codemagic.yaml` only has iOS. We need to add an `android_workflow` to build APKs/AABs automatically.
- [ ] **OTA Updates**: Configure **Capacitor Live Updates (or OTA)** to push JS changes without a full store release.

### Quality Assurance
- [ ] **Unit Testing**: Add `vitest` to `web/` to test scoring logic (e.g., `calculateTotalValue`, `sanitizeTeamRoles`) in isolation.
- [ ] **E2E Testing**: Add `Playwright` to test critical flows (Login -> Buy Driver -> Set Captain).
- [ ] **Error Monitoring**: Integrate **Sentry** to track crashes in production (both web and native).

## 4. UX/UI Polish

- [ ] **Onboarding Flow**: A dedicated "Welcome" wizard for new users explaining the rules (Budget, Captain, Reserve).
- [ ] **Dark/Light Mode**: Fully support system theme preference (currently mostly dark mode hardcoded).
- [ ] **Animations**: Add `framer-motion` for smooth transitions between tabs/pages.

---

## Suggested Immediate Next Steps (Sprint 1)

1. **Refactor**: Extract `Market` and `Garage` from `App.tsx`.
2. **CI**: Add Android build step to `codemagic.yaml`.
3. **Feature**: Implement the `Standings` view (it's currently missing/hidden).
