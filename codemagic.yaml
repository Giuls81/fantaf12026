workflows:
  ios_testflight:
    name: iOS Release (Capacitor) - TestFlight
    max_build_duration: 90
    environment:
      node: 22
      xcode: latest
      vars:
        IOS_DIR: "ios/App"
        XCODE_SCHEME: "App"
        BUNDLE_ID: "com.fantaf1.app"
        VITE_API_URL: "https://laqjyqfnjnofmvgedunl.supabase.co/functions/v1/fanta-api"
    # ... previous ios scripts ...
    scripts:
      - name: Install deps
        script: npm ci
      - name: Build web
        script: |
          cd web
          npm ci
          VITE_API_URL=$VITE_API_URL npm run build
      - name: Sync Capacitor iOS
        script: npx cap sync ios
      # ... rest of ios scripts ...

  android_release:
    name: Android Release (APK/AAB)
    max_build_duration: 60
    environment:
      node: 22
      vars:
        ANDROID_DIR: "android"
        VITE_API_URL: "https://laqjyqfnjnofmvgedunl.supabase.co/functions/v1/fanta-api"
    scripts:
      - name: Install deps
        script: npm ci
      - name: Build web
        script: |
          cd web
          npm ci
          VITE_API_URL=$VITE_API_URL npm run build
      - name: Add/Sync Android
        script: |
          npx cap add android || true
          npx cap sync android
      - name: Build Android APK
        script: |
          cd android
          ./gradlew assembleRelease
    artifacts:
      - android/app/build/outputs/apk/release/*.apk
      - android/app/build/outputs/bundle/release/*.aab
